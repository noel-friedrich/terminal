<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Terminal Commands</title>
        <link rel="stylesheet" href="../style.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lora">
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Quicksand">
        <link rel="icon" type="image/x-icon" href="../res/img/favicon.png">
    </head>
    
    <body>
        <header>
            <img src="../res/img/favicon.png" alt="Logo" class="logo">
            <h1><a href="index.html">terminal</a></h1>
        </header>

        <main>

            <h1>
                Commands
            </h1>

            <p>
                Welcome to the Graphical User Interface of my 
                <a href="https://noel-friedrich.de/terminal/">terminal</a>. Click on a
                command to open its page. Some commands won't work or make much sense
                in this GUI form - try them in the <a href="https://noel-friedrich.de/terminal/">terminal</a> instead!
            </p>

            <input id="searchInput" type="text" placeholder="search a command">

            <div id="commandContainer"></div>

        </main>

        <footer>
            Generated by <a href="https://www.noel-friedrich.de/">Noel Friedrich</a><div style="width:1em;display:inline-block">;</div>
            <a href="http://www.noel-friedrich.de/blobber/legal/impressum">Impressum</a>
            <a href="http://www.noel-friedrich.de/blobber/legal/data-policy">Privacy</a>
        </footer>

        <script>
            const commandContainer = document.querySelector("#commandContainer")
            const searchInput = document.querySelector("#searchInput")
            let terminal = {}
        </script>

        <script src="../js/load-commands.js"></script>

        <script>
            function makeCommandList(commandData) {
                commandContainer.innerHTML = ""
                for (let [command, info] of commandData) {
                    if (info.isSecret) continue
                    const anchor = document.createElement("a")
                    anchor.href = `./${command}/index.html`
                    anchor.classList.add("linkbutton")
                    anchor.textContent = command
                    commandContainer.appendChild(anchor)
                }
            }

            makeCommandList(Object.entries(terminal.commandData))

            function levenshteinDistance(str1, str2) {
                const track = Array(str2.length + 1).fill(null).map(
                    () => Array(str1.length + 1).fill(null))

                for (let i = 0; i <= str1.length; i += 1) track[0][i] = i
                for (let j = 0; j <= str2.length; j += 1) track[j][0] = j

                for (let j = 1; j <= str2.length; j += 1) {
                    for (let i = 1; i <= str1.length; i += 1) {
                        const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1
                        track[j][i] = Math.min(
                            track[j][i - 1] + 1,
                            track[j - 1][i] + 1,
                            track[j - 1][i - 1] + indicator,
                        )
                    }
                }

                return track[str2.length][str1.length]
            }

            searchInput.oninput = () => {
                const prompt = searchInput.value
                const tokens = prompt.split(" ").filter(p => p.length > 0).map(t => t.toLowerCase())

                let results = Object.entries(terminal.commandData)
                results.sort((a, b) => {
                    let total1 = 0
                    let total2 = 0
                    for (let token of tokens) {
                        total1 += levenshteinDistance(a[0], token)
                        total2 += levenshteinDistance(b[0], token)
                    }
                    return total1 - total2
                })

                makeCommandList(results)
            }
        </script>
        
    </body>

</html>